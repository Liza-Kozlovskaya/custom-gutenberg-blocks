{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/menu.native.js"],"names":["InserterMenu","onSelect","onDismiss","rootClientId","clientId","isAppender","shouldReplaceBlock","insertionIndex","blockEditorStore","showInsertionPoint","hideInsertionPoint","clearSelectedBlock","insertBlock","removeBlock","resetBlocks","insertDefaultBlock","select","getInserterItems","getBlockRootClientId","getBlockSelectionEnd","selectBlockEditorStore","targetRootClientId","end","undefined","items","destinationRootClientId","getBlockOrder","getBlockCount","canInsertBlockType","blocksStore","getBlockType","count","blockToReplace","onClose","onInsert","item","name","initialAttributes","innerBlocks","newBlock","getItems","itemsToDisplay","filter","clipboard","clipboardBlock","HTML","canAddClipboardBlock","icon","attributes","id"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useEffect, useCallback } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tcreateBlock,\n\trawHandler,\n\tstore as blocksStore,\n} from '@wordpress/blocks';\nimport { getClipboard } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\n\nimport InserterSearchResults from './search-results';\nimport { store as blockEditorStore } from '../../store';\n\nfunction InserterMenu( {\n\tonSelect,\n\tonDismiss,\n\trootClientId,\n\tclientId,\n\tisAppender,\n\tshouldReplaceBlock,\n\tinsertionIndex,\n} ) {\n\tconst {\n\t\tshowInsertionPoint,\n\t\thideInsertionPoint,\n\t\tclearSelectedBlock,\n\t\tinsertBlock,\n\t\tremoveBlock,\n\t\tresetBlocks,\n\t\tinsertDefaultBlock,\n\t} = useDispatch( blockEditorStore );\n\n\tconst {\n\t\titems,\n\t\tdestinationRootClientId,\n\t\tgetBlockOrder,\n\t\tgetBlockCount,\n\t\tcanInsertBlockType,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetInserterItems,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetBlockSelectionEnd,\n\t\t\t...selectBlockEditorStore\n\t\t} = select( blockEditorStore );\n\n\t\tlet targetRootClientId = rootClientId;\n\t\tif ( ! targetRootClientId && ! clientId && ! isAppender ) {\n\t\t\tconst end = getBlockSelectionEnd();\n\t\t\tif ( end ) {\n\t\t\t\ttargetRootClientId = getBlockRootClientId( end ) || undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\titems: getInserterItems( targetRootClientId ),\n\t\t\tdestinationRootClientId: targetRootClientId,\n\t\t\tgetBlockOrder: selectBlockEditorStore.getBlockOrder,\n\t\t\tgetBlockCount: selectBlockEditorStore.getBlockCount,\n\t\t\tcanInsertBlockType: selectBlockEditorStore.canInsertBlockType,\n\t\t};\n\t} );\n\n\tconst { getBlockType } = useSelect( ( select ) => select( blocksStore ) );\n\n\tuseEffect( () => {\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tconst count = getBlockCount();\n\t\t\t// Check if there is a rootClientId because that means it is a nested replaceable block\n\t\t\t// and we don't want to clear/reset all blocks.\n\t\t\tif ( count === 1 && ! rootClientId ) {\n\t\t\t\t// Removing the last block is not possilble with `removeBlock` action.\n\t\t\t\t// It always inserts a default block if the last of the blocks have been removed.\n\t\t\t\tclearSelectedBlock();\n\t\t\t\tresetBlocks( [] );\n\t\t\t} else {\n\t\t\t\tconst blockToReplace = getBlockOrder( destinationRootClientId )[\n\t\t\t\t\tinsertionIndex\n\t\t\t\t];\n\t\t\t\tremoveBlock( blockToReplace, false );\n\t\t\t}\n\t\t}\n\t\t// Show/Hide insertion point on Mount/Dismount\n\t\tshowInsertionPoint( destinationRootClientId, insertionIndex );\n\t\treturn hideInsertionPoint;\n\t}, [] );\n\n\tconst onClose = useCallback( () => {\n\t\t// If should replace but didn't insert any block\n\t\t// re-insert default block.\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tinsertDefaultBlock( {}, destinationRootClientId, insertionIndex );\n\t\t}\n\t\tonDismiss();\n\t}, [ shouldReplaceBlock, destinationRootClientId, insertionIndex ] );\n\n\tconst onInsert = useCallback(\n\t\t( item ) => {\n\t\t\tconst { name, initialAttributes, innerBlocks } = item;\n\n\t\t\tconst newBlock = createBlock(\n\t\t\t\tname,\n\t\t\t\tinitialAttributes,\n\t\t\t\tinnerBlocks\n\t\t\t);\n\n\t\t\tinsertBlock( newBlock, insertionIndex, destinationRootClientId );\n\t\t},\n\t\t[ insertBlock, destinationRootClientId, insertionIndex ]\n\t);\n\n\t/**\n\t * Processes the inserter items to check\n\t * if there's any copied block in the clipboard\n\t * to add it as an extra item\n\t */\n\tfunction getItems() {\n\t\t// Filter out reusable blocks (they will be added in another tab)\n\t\tconst itemsToDisplay = items.filter(\n\t\t\t( { name } ) => name !== 'core/block'\n\t\t);\n\n\t\tconst clipboard = getClipboard();\n\t\tlet clipboardBlock = rawHandler( { HTML: clipboard } )[ 0 ];\n\n\t\tconst canAddClipboardBlock = canInsertBlockType(\n\t\t\tclipboardBlock?.name,\n\t\t\tdestinationRootClientId\n\t\t);\n\n\t\tif ( ! canAddClipboardBlock ) {\n\t\t\treturn itemsToDisplay;\n\t\t}\n\n\t\tconst { icon, name } = getBlockType( clipboardBlock.name );\n\t\tconst { attributes: initialAttributes, innerBlocks } = clipboardBlock;\n\n\t\tclipboardBlock = {\n\t\t\tid: 'clipboard',\n\t\t\tname,\n\t\t\ticon,\n\t\t\tinitialAttributes,\n\t\t\tinnerBlocks,\n\t\t};\n\n\t\treturn [ clipboardBlock, ...itemsToDisplay ];\n\t}\n\n\treturn (\n\t\t<InserterSearchResults\n\t\t\tonClose={ onClose }\n\t\t\titems={ getItems() }\n\t\t\tonSelect={ ( item ) => {\n\t\t\t\tonInsert( item );\n\t\t\t\tonSelect( item );\n\t\t\t} }\n\t\t/>\n\t);\n}\n\nexport default InserterMenu;\n"]}