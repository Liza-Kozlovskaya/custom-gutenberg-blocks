{"version":3,"sources":["@wordpress/block-editor/src/components/block-navigation/block.js"],"names":["classnames","__experimentalTreeGridCell","TreeGridCell","__experimentalTreeGridItem","TreeGridItem","MenuGroup","MenuItem","__","moreVertical","useState","useRef","useEffect","useDispatch","useSelect","BlockNavigationLeaf","BlockMoverUpButton","BlockMoverDownButton","BlockNavigationBlockContents","BlockSettingsDropdown","useBlockNavigationContext","store","blockEditorStore","BlockNavigationBlock","block","isSelected","onClick","position","level","rowCount","siblingBlockCount","showBlockMovers","path","cellRef","isHovered","setIsHovered","clientId","select","isBlockBeingDragged","isAncestorBeingDragged","getBlockParents","isDragging","blockParents","selectEditorBlock","selectBlock","toggleBlockHighlight","hasSiblings","hasRenderedMovers","moverCellClassName","withExperimentalFeatures","__experimentalFeatures","withExperimentalPersistentListViewFeatures","__experimentalPersistentListViewFeatures","blockNavigationBlockSettingsClassName","current","focus","highlightBlock","onMouseEnter","onMouseLeave","undefined","ref","tabIndex","onFocus","onClose","length","parent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\t__experimentalTreeGridCell as TreeGridCell,\n\t__experimentalTreeGridItem as TreeGridItem,\n\tMenuGroup,\n\tMenuItem,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { moreVertical } from '@wordpress/icons';\nimport { useState, useRef, useEffect } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport BlockNavigationLeaf from './leaf';\nimport {\n\tBlockMoverUpButton,\n\tBlockMoverDownButton,\n} from '../block-mover/button';\nimport BlockNavigationBlockContents from './block-contents';\nimport BlockSettingsDropdown from '../block-settings-menu/block-settings-dropdown';\nimport { useBlockNavigationContext } from './context';\nimport { store as blockEditorStore } from '../../store';\n\nexport default function BlockNavigationBlock( {\n\tblock,\n\tisSelected,\n\tonClick,\n\tposition,\n\tlevel,\n\trowCount,\n\tsiblingBlockCount,\n\tshowBlockMovers,\n\tpath,\n} ) {\n\tconst cellRef = useRef( null );\n\tconst [ isHovered, setIsHovered ] = useState( false );\n\tconst { clientId } = block;\n\tconst { isDragging, blockParents } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tisBlockBeingDragged,\n\t\t\t\tisAncestorBeingDragged,\n\t\t\t\tgetBlockParents,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\treturn {\n\t\t\t\tisDragging:\n\t\t\t\t\tisBlockBeingDragged( clientId ) ||\n\t\t\t\t\tisAncestorBeingDragged( clientId ),\n\t\t\t\tblockParents: getBlockParents( clientId ),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tconst {\n\t\tselectBlock: selectEditorBlock,\n\t\ttoggleBlockHighlight,\n\t} = useDispatch( blockEditorStore );\n\n\tconst hasSiblings = siblingBlockCount > 0;\n\tconst hasRenderedMovers = showBlockMovers && hasSiblings;\n\tconst moverCellClassName = classnames(\n\t\t'block-editor-block-navigation-block__mover-cell',\n\t\t{ 'is-visible': isHovered }\n\t);\n\tconst {\n\t\t__experimentalFeatures: withExperimentalFeatures,\n\t\t__experimentalPersistentListViewFeatures: withExperimentalPersistentListViewFeatures,\n\t} = useBlockNavigationContext();\n\tconst blockNavigationBlockSettingsClassName = classnames(\n\t\t'block-editor-block-navigation-block__menu-cell',\n\t\t{ 'is-visible': isHovered }\n\t);\n\n\t// If BlockNavigation has experimental features related to the Persistent List View,\n\t// only focus the selected list item on mount; otherwise the list would always\n\t// try to steal the focus from the editor canvas.\n\tuseEffect( () => {\n\t\tif ( withExperimentalPersistentListViewFeatures && isSelected ) {\n\t\t\tcellRef.current.focus();\n\t\t}\n\t}, [] );\n\n\t// If BlockNavigation has experimental features (such as drag and drop) enabled,\n\t// leave the focus handling as it was before, to avoid accidental regressions.\n\tuseEffect( () => {\n\t\tif ( withExperimentalFeatures && isSelected ) {\n\t\t\tcellRef.current.focus();\n\t\t}\n\t}, [ withExperimentalFeatures, isSelected ] );\n\n\tconst highlightBlock = withExperimentalPersistentListViewFeatures\n\t\t? toggleBlockHighlight\n\t\t: () => {};\n\n\tconst onMouseEnter = () => {\n\t\tsetIsHovered( true );\n\t\thighlightBlock( clientId, true );\n\t};\n\tconst onMouseLeave = () => {\n\t\tsetIsHovered( false );\n\t\thighlightBlock( clientId, false );\n\t};\n\n\treturn (\n\t\t<BlockNavigationLeaf\n\t\t\tclassName={ classnames( {\n\t\t\t\t'is-selected': isSelected,\n\t\t\t\t'is-dragging': isDragging,\n\t\t\t} ) }\n\t\t\tonMouseEnter={ onMouseEnter }\n\t\t\tonMouseLeave={ onMouseLeave }\n\t\t\tonFocus={ onMouseEnter }\n\t\t\tonBlur={ onMouseLeave }\n\t\t\tlevel={ level }\n\t\t\tposition={ position }\n\t\t\trowCount={ rowCount }\n\t\t\tpath={ path }\n\t\t\tid={ `block-navigation-block-${ clientId }` }\n\t\t\tdata-block={ clientId }\n\t\t>\n\t\t\t<TreeGridCell\n\t\t\t\tclassName=\"block-editor-block-navigation-block__contents-cell\"\n\t\t\t\tcolSpan={ hasRenderedMovers ? undefined : 2 }\n\t\t\t\tref={ cellRef }\n\t\t\t>\n\t\t\t\t{ ( { ref, tabIndex, onFocus } ) => (\n\t\t\t\t\t<div className=\"block-editor-block-navigation-block__contents-container\">\n\t\t\t\t\t\t<BlockNavigationBlockContents\n\t\t\t\t\t\t\tblock={ block }\n\t\t\t\t\t\t\tonClick={ () => onClick( block.clientId ) }\n\t\t\t\t\t\t\tisSelected={ isSelected }\n\t\t\t\t\t\t\tposition={ position }\n\t\t\t\t\t\t\tsiblingBlockCount={ siblingBlockCount }\n\t\t\t\t\t\t\tlevel={ level }\n\t\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\t\ttabIndex={ tabIndex }\n\t\t\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t</TreeGridCell>\n\t\t\t{ hasRenderedMovers && (\n\t\t\t\t<>\n\t\t\t\t\t<TreeGridCell\n\t\t\t\t\t\tclassName={ moverCellClassName }\n\t\t\t\t\t\twithoutGridItem\n\t\t\t\t\t>\n\t\t\t\t\t\t<TreeGridItem>\n\t\t\t\t\t\t\t{ ( { ref, tabIndex, onFocus } ) => (\n\t\t\t\t\t\t\t\t<BlockMoverUpButton\n\t\t\t\t\t\t\t\t\torientation=\"vertical\"\n\t\t\t\t\t\t\t\t\tclientIds={ [ clientId ] }\n\t\t\t\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\t\t\t\ttabIndex={ tabIndex }\n\t\t\t\t\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</TreeGridItem>\n\t\t\t\t\t\t<TreeGridItem>\n\t\t\t\t\t\t\t{ ( { ref, tabIndex, onFocus } ) => (\n\t\t\t\t\t\t\t\t<BlockMoverDownButton\n\t\t\t\t\t\t\t\t\torientation=\"vertical\"\n\t\t\t\t\t\t\t\t\tclientIds={ [ clientId ] }\n\t\t\t\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\t\t\t\ttabIndex={ tabIndex }\n\t\t\t\t\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</TreeGridItem>\n\t\t\t\t\t</TreeGridCell>\n\t\t\t\t</>\n\t\t\t) }\n\n\t\t\t{ withExperimentalFeatures && (\n\t\t\t\t<TreeGridCell\n\t\t\t\t\tclassName={ blockNavigationBlockSettingsClassName }\n\t\t\t\t>\n\t\t\t\t\t{ ( { ref, tabIndex, onFocus } ) => (\n\t\t\t\t\t\t<BlockSettingsDropdown\n\t\t\t\t\t\t\tclientIds={ [ clientId ] }\n\t\t\t\t\t\t\ticon={ moreVertical }\n\t\t\t\t\t\t\ttoggleProps={ {\n\t\t\t\t\t\t\t\tref,\n\t\t\t\t\t\t\t\ttabIndex,\n\t\t\t\t\t\t\t\tonFocus,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tdisableOpenOnArrowDown\n\t\t\t\t\t\t\t__experimentalSelectBlock={ onClick }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ ( { onClose } ) => (\n\t\t\t\t\t\t\t\t<MenuGroup>\n\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\tonClick={ async () => {\n\t\t\t\t\t\t\t\t\t\t\tif ( blockParents.length ) {\n\t\t\t\t\t\t\t\t\t\t\t\t// If the block to select is inside a dropdown, we need to open the dropdown.\n\t\t\t\t\t\t\t\t\t\t\t\t// Otherwise focus won't transfer to the block.\n\t\t\t\t\t\t\t\t\t\t\t\tfor ( const parent of blockParents ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait selectEditorBlock(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tparent\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t// If clientId is already selected, it won't be focused (see block-wrapper.js)\n\t\t\t\t\t\t\t\t\t\t\t\t// This removes the selection first to ensure the focus will always switch.\n\t\t\t\t\t\t\t\t\t\t\t\tawait selectEditorBlock( null );\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tawait selectEditorBlock( clientId );\n\t\t\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ __( 'Go to block' ) }\n\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t</MenuGroup>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</BlockSettingsDropdown>\n\t\t\t\t\t) }\n\t\t\t\t</TreeGridCell>\n\t\t\t) }\n\t\t</BlockNavigationLeaf>\n\t);\n}\n"]}